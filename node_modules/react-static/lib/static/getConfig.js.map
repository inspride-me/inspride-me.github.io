{"version":3,"sources":["../../src/static/getConfig.js"],"names":["defaultConfig","DEFAULT_NAME_FOR_STATIC_CONFIG_FILE","DEFAULT_PATH_FOR_STATIC_CONFIG","nodePath","resolve","join","process","cwd","DEFAULT_ROUTES","path","DEFAULT_ENTRY","buildConfig","config","paths","root","src","dist","temp","devDist","public","plugins","pages","nodeModules","assets","resolvePath","relativePath","DIST","env","REACT_STATIC_ENV","ASSETS","ROOT","LOCAL_NODE_MODULES","SRC","PAGES","PLUGINS","TEMP","PUBLIC","NODE_MODULES","EXCLUDE_MODULES","excludeResolvedModules","PACKAGE","HTML_TEMPLATE","STATIC_DATA","siteRoot","basePath","devBasePath","REACT_STATIC_STAGING","stagingSiteRoot","stagingBasePath","publicPath","assetsPath","entry","getSiteData","renderToElement","Comp","renderToHtml","render","comp","prefetchRate","maxThreads","Infinity","disableRoutePrefixing","outputFileRate","extensions","getRoutes","minLoadTime","disablePreload","disableRuntime","preloadPollInterval","babelExcludes","extractCssChunks","inlineCss","REACT_STATIC_MIN_LOAD_TIME","REACT_STATIC_PREFETCH_RATE","REACT_STATIC_DISABLE_ROUTE_PREFIXING","REACT_STATIC_DISABLE_PRELOAD","REACT_STATIC_DISABLE_RUNTIME","REACT_STATIC_PRELOAD_POLL_INTERVAL","REACT_STATIC_TEMPLATES_PATH","REACT_STATIC_PLUGINS_PATH","REACT_STATIC_UNIVERSAL_PATH","require","resolvePlugin","originalLocation","options","Array","isArray","location","fs","pathExistsSync","found","includes","err","reduce","prev","curr","NODE_ENV","Error","nodeLocation","browserLocation","getHooks","default","resolvedPlugin","hooks","map","console","error","configHook","buildConfigFromPath","configPath","cache","subscription","noConfig","existsSync","Promise","chokidar","watch","on","getConfig"],"mappings":"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","sourcesContent":["/* eslint-disable import/no-dynamic-require */\n\nimport React from 'react'\nimport nodePath from 'path'\nimport chokidar from 'chokidar'\nimport resolveFrom from 'resolve-from'\nimport fs from 'fs-extra'\n\nimport getDirname from '../utils/getDirname'\nimport {\n  cleanSlashes,\n  cutPathToRoot,\n  isAbsoluteUrl,\n  makeHookReducer,\n} from '../utils'\n\n// the default static.config.js location\nconst defaultConfig = {}\nconst DEFAULT_NAME_FOR_STATIC_CONFIG_FILE = 'static.config.js'\nconst DEFAULT_PATH_FOR_STATIC_CONFIG = nodePath.resolve(\n  nodePath.join(process.cwd(), DEFAULT_NAME_FOR_STATIC_CONFIG_FILE)\n)\nconst DEFAULT_ROUTES = [{ path: '/' }]\nconst DEFAULT_ENTRY = 'index.js'\n\nexport const buildConfig = async (config = {}) => {\n  // path defaults\n  config.paths = {\n    root: nodePath.resolve(process.cwd()),\n    src: 'src',\n    dist: 'dist',\n    temp: 'tmp',\n    devDist: 'tmp/dev-server',\n    public: 'public',\n    plugins: 'plugins',\n    pages: 'src/pages',\n    nodeModules: 'node_modules',\n    assets: '',\n    ...(config.paths || {}),\n  }\n\n  // Use the root to resolve all other relative paths\n  const resolvePath = relativePath =>\n    nodePath.resolve(config.paths.root, relativePath)\n\n  // Resolve all paths\n  const DIST =\n    process.env.REACT_STATIC_ENV === 'development'\n      ? resolvePath(config.paths.devDist || config.paths.dist)\n      : resolvePath(config.paths.dist)\n\n  const ASSETS = nodePath.resolve(DIST, config.paths.assets)\n\n  const paths = {\n    ROOT: config.paths.root,\n    LOCAL_NODE_MODULES: nodePath.resolve(getDirname(), '../../node_modules'),\n    SRC: resolvePath(config.paths.src),\n    PAGES: resolvePath(config.paths.pages),\n    DIST,\n    ASSETS,\n    PLUGINS: resolvePath(config.paths.plugins),\n    TEMP: resolvePath(config.paths.temp),\n    PUBLIC: resolvePath(config.paths.public),\n    NODE_MODULES: resolvePath(config.paths.nodeModules),\n    EXCLUDE_MODULES:\n      config.paths.excludeResolvedModules ||\n      resolvePath(config.paths.nodeModules),\n    PACKAGE: resolvePath('package.json'),\n    HTML_TEMPLATE: nodePath.join(DIST, 'index.html'),\n    STATIC_DATA: nodePath.join(ASSETS, 'staticData'),\n  }\n\n  let siteRoot = ''\n  let basePath = ''\n\n  if (process.env.REACT_STATIC_ENV === 'development') {\n    basePath = cleanSlashes(config.devBasePath)\n  } else if (process.env.REACT_STATIC_STAGING === 'true') {\n    siteRoot = cutPathToRoot(config.stagingSiteRoot, '$1')\n    basePath = cleanSlashes(config.stagingBasePath)\n  } else {\n    siteRoot = cutPathToRoot(config.siteRoot, '$1')\n    basePath = cleanSlashes(config.basePath)\n  }\n\n  const publicPath = `${cleanSlashes(`${siteRoot}/${basePath}`)}/`\n\n  let assetsPath = cleanSlashes(config.assetsPath || paths.assets)\n  if (assetsPath && !isAbsoluteUrl(assetsPath)) {\n    assetsPath = `/${cleanSlashes(`${basePath}/${assetsPath}`)}/`\n  }\n\n  // Add the project root as a plugin. This allows the dev\n  // to use the plugin api directory in their project if they want\n  const plugins = [...(config.plugins || []), paths.ROOT]\n\n  // Defaults\n  config = {\n    // Defaults\n    entry: nodePath.join(paths.SRC, DEFAULT_ENTRY),\n    getSiteData: () => ({}),\n    renderToElement: Comp => <Comp />,\n    renderToHtml: (render, comp) => render(comp),\n    prefetchRate: 5,\n    maxThreads: Infinity,\n    disableRoutePrefixing: false,\n    outputFileRate: 100,\n    extensions: ['.js', '.jsx'],\n    getRoutes: async () => DEFAULT_ROUTES,\n    minLoadTime: 200,\n    disablePreload: false,\n    disableRuntime: false,\n    preloadPollInterval: 300,\n    // Config Overrides\n    ...config,\n    // Materialized Overrides\n    plugins,\n    paths,\n    babelExcludes: config.babelExcludes || [],\n    siteRoot,\n    basePath,\n    publicPath,\n    assetsPath,\n    extractCssChunks: config.extractCssChunks || false,\n    inlineCss: config.inlineCss || false,\n  }\n\n  // Set env variables to be used client side\n  process.env.REACT_STATIC_MIN_LOAD_TIME = config.minLoadTime\n  process.env.REACT_STATIC_PREFETCH_RATE = config.prefetchRate\n  process.env.REACT_STATIC_DISABLE_ROUTE_PREFIXING =\n    config.disableRoutePrefixing\n  process.env.REACT_STATIC_DISABLE_PRELOAD = config.disablePreload\n  process.env.REACT_STATIC_DISABLE_RUNTIME = config.disableRuntime\n  process.env.REACT_STATIC_PRELOAD_POLL_INTERVAL = config.preloadPollInterval\n\n  process.env.REACT_STATIC_TEMPLATES_PATH = nodePath.join(\n    DIST,\n    'react-static-templates.js'\n  )\n  process.env.REACT_STATIC_PLUGINS_PATH = nodePath.join(\n    DIST,\n    'react-static-browser-plugins.js'\n  )\n  process.env.REACT_STATIC_UNIVERSAL_PATH = require.resolve(\n    'react-universal-component'\n  )\n\n  const resolvePlugin = originalLocation => {\n    let options = {}\n    if (Array.isArray(originalLocation)) {\n      originalLocation = originalLocation[0]\n      options = originalLocation[1] || {}\n    }\n\n    const location = [\n      () => {\n        // Absolute\n        if (fs.pathExistsSync(originalLocation)) {\n          return originalLocation\n        }\n      },\n      () => {\n        // Absolute require\n        try {\n          const found = require.resolve(originalLocation)\n          return found.includes('.') ? nodePath.resolve(found, '../') : found\n        } catch (err) {\n          //\n        }\n      },\n      () => {\n        // Plugins Dir\n        const found = nodePath.resolve(paths.PLUGINS, originalLocation)\n        if (fs.pathExistsSync(found)) {\n          return found\n        }\n      },\n      () => {\n        // Plugins Dir require\n        try {\n          const found = resolveFrom(paths.PLUGINS, originalLocation)\n          return found.includes('.') ? nodePath.resolve(found, '../') : found\n        } catch (err) {\n          //\n        }\n      },\n      () => {\n        // CWD\n        const found = nodePath.resolve(process.cwd(), originalLocation)\n        if (fs.pathExistsSync(found)) {\n          return found\n        }\n      },\n      () => {\n        // CWD require\n        try {\n          const found = resolveFrom(process.cwd(), originalLocation)\n          return found.includes('.') ? nodePath.resolve(found, '../') : found\n        } catch (err) {\n          //\n        }\n      },\n    ].reduce((prev, curr) => prev || curr(), null)\n\n    // TODO: We have to do this because we don't have a good mock for process.cwd() :(\n    if (process.env.NODE_ENV !== 'test' && !location) {\n      throw new Error(\n        `Oh crap! Could not find a plugin directory for the plugin: \"${location}\". We must bail!`\n      )\n    }\n\n    let nodeLocation = nodePath.join(location, 'node.api.js')\n    let browserLocation = nodePath.join(location, 'browser.api.js')\n    let getHooks = () => ({})\n\n    try {\n      // Get the hooks for the node api\n      if (fs.pathExistsSync(nodeLocation)) {\n        getHooks = require(nodeLocation).default\n      } else {\n        nodeLocation = null\n      }\n\n      // Detect if the browser plugin entry exists, and provide the nodeResolver to it\n      browserLocation = fs.pathExistsSync(browserLocation)\n        ? browserLocation\n        : null\n\n      const resolvedPlugin = {\n        location,\n        nodeLocation,\n        browserLocation,\n        options,\n        hooks: getHooks(options) || {},\n      }\n\n      // Recursively resolve plugins\n      if (resolvedPlugin.plugins) {\n        resolvedPlugin.plugins = resolvedPlugin.plugins.map(resolvePlugin)\n      }\n\n      return resolvedPlugin\n    } catch (err) {\n      console.error(\n        `The following error occurred in the plugin located at \"${nodeLocation}\"`\n      )\n      throw err\n    }\n  }\n\n  config.plugins = config.plugins.map(resolvePlugin)\n\n  const configHook = makeHookReducer(config.plugins, 'config')\n  config = await configHook(config)\n\n  return config\n}\n\nconst buildConfigFromPath = async configPath => {\n  delete require.cache[configPath]\n  const config = require(configPath).default\n  return buildConfig(config)\n}\n\n// Retrieves the static.config.js from the current project directory\nexport default (async function getConfig(\n  configPath = DEFAULT_PATH_FOR_STATIC_CONFIG,\n  subscription\n) {\n  configPath = nodePath.resolve(configPath)\n\n  const noConfig =\n    configPath === DEFAULT_PATH_FOR_STATIC_CONFIG && !fs.existsSync(configPath)\n\n  if (noConfig) {\n    if (subscription) {\n      return new Promise(async () => {\n        subscription(await buildConfig(defaultConfig))\n      })\n    }\n    return buildConfig(defaultConfig)\n  }\n\n  const config = await buildConfigFromPath(configPath)\n\n  if (subscription) {\n    // If subscribing, return a never ending promise\n    return new Promise(() => {\n      chokidar.watch(configPath).on('all', async () => {\n        subscription(await buildConfigFromPath(configPath))\n      })\n    })\n  }\n\n  return config\n})\n"],"file":"getConfig.js"}